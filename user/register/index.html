<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tourist Registration</title>
    <link rel="icon" type="image/x-icon" href="/SagadaRegistrationSystem/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&family=Pacifico&display=swap" rel="stylesheet">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js">
    </script>
    <script type="text/javascript">
        (function () {
            emailjs.init({
                publicKey: "qCwoFnSDmaCx9HtKS",
            });
        })();
    </script>
    <link rel="stylesheet" href="./style.css">
    <script src="../../js/registration.js" type="module"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body id="body">
    <!-- Fixed Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">

            <!-- Logo (Left) -->
            <a href="#" class="logo">
                <img src="/SagadaRegistrationSystem/images/sagada-tourism-logo.png" alt="Sagada Logo">
                <span>Sagada Tourism</span>
            </a>

            <!-- Center Nav Links -->
            <ul class="nav-links" id="nav-links">
                <li><a href="/SagadaRegistrationSystem/index.html">Home</a></li>

                <!-- Dropdown 1: Explore -->
                <li class="dropdown-nav ">
                    <a href="#">Explore ▾</a>
                    <ul class="dropdown-menu">
                        <li><a href="/SagadaRegistrationSystem/user/tourist-spots/index.html">Places you can visit</a>
                        </li>
                        <li><a href="/SagadaRegistrationSystem/user/reviews/index.html">Reviews</a></li>
                    </ul>
                </li>

                <!-- Dropdown 2: Information -->
                <li class="dropdown-nav ">
                    <a href="#">Information ▾</a>
                    <ul class="dropdown-menu">
                        <li><a href="/SagadaRegistrationSystem/about/index.html">About Sagada</a></li>
                        <li><a href="/SagadaRegistrationSystem/index.html#tourist-guidelines">Tourist Guidelines</a>
                        </li>
                        <li><a href="/SagadaRegistrationSystem/index.html#faq">FAQ</a></li>
                        <li><a href="/SagadaRegistrationSystem/user/analytics/index.html">Analytics</a></li>
                    </ul>
                </li>

                <!-- Dropdown 3: Tourist Actions -->
                <li class="dropdown-nav ">
                    <a href="#">Tourist Actions ▾</a>
                    <ul class="dropdown-menu">
                        <li><a href="/SagadaRegistrationSystem/user/register/index.html">Book a Visit</a></li>
                        <li><a href="/SagadaRegistrationSystem/user/registration-per-site/index.html">Tourist Site
                                Check-In</a></li>
                    </ul>
                </li>

                <li><a href="/SagadaRegistrationSystem/contact/index.html">Contact</a></li>

                <li id="profileMobile"><a href="/SagadaRegistrationSystem/user/profile/index.html">Profile</a></li>

                <li id="authLinkMobile"><button class="login-btn">Login</button></li>

                <li id="logoutLinkMobile"><button class="logout-btn">Logout</button></li>
            </ul>

            <!-- Right: Login + Hamburger -->
            <div class="nav-right">
                <button class="login-btn desktop-login" id="authLinkDesktop">Login</button>
                <button class="hamburger" id="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>

        </div>
    </nav>

    <!-- Warning Modal (Highest Priority) -->
    <div id="warningModal" class="modal-overlay" style="z-index: 9999; display: none;">
        <div class="modal-content">
            <h2>Warning!</h2>
            <p>Your profile information is incomplete. Please update your personal details or groups to proceed with
                registration.</p>
            <button class="button" id="goToProfileBtn">Go to Profile</button>
        </div>
    </div>

    <!-- Group Required Modal -->
    <div id="groupRequiredModal" class="modal-overlay" style="z-index: 9999; display: none;">
        <div class="modal-content">
            <h2>Invalid Selection</h2>
            <p>You must create a group in your Profile page first before registering as a group.</p>
            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: center;">
                <button class="button" id="goToProfileBtnGroup">Go to Profile</button>
                <button class="button" id="closeGroupRequiredModal">Close</button>
            </div>
        </div>
    </div>



    <!-- The Modal -->
    <div id="noticeModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Notice</h2>
            <p>Welcome to the Tourist Registration Portal.
                By proceeding, you agree to provide accurate
                information for the purpose of registration.
                This information will be used to facilitate
                your travel and ensure your safety during
                your visit.</p>
            <button class="button" id="acknowledgeButton">I Understand</button>
        </div>
    </div>

    <div class="container">
        <h1>Tourist Registration</h1>

        <form id="registrationForm">
            <label>Are you registering for an/a?</label>
            <select id="groupRegistration" required>
                <option value="">Select an option</option>
                <option value="individual">Individual</option>
                <option value="group">Group</option>
            </select>

            <!-- Individual Form -->
            <div id="individualForm" style="display:none;">
                <label>Date of Registration</label>
                <input type="date" id="dateOfRegistration" required>

                <label>Full Name:</label>
                <input type="text" id="fullName" required>

                <label>Date of Birth:</label>
                <input type="date" id="dateOfBirth" required>

                <label>Sex:</label>
                <select id="sex" required>
                    <option value="">Select</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                </select>

                <label>Country of Origin:</label>
                <select id="country" required></select>

                <label>Region:</label>
                <select id="region" required></select>

                <label>Phone Number:</label>
                <input type="text" id="phone" required>

                <label>Email:</label>
                <input type="email" id="email" readonly required>
            </div>

            <!-- Group Form -->
            <div id="groupForm" style="display:none;">
                <label>Date of Registration</label>
                <input type="date" id="groupDateOfRegistration" required>

                <label>Select Group</label>
                <select id="existingGroupSelect" required>
                    <option value="">Select a group</option>
                </select>

                <div id="groupMembersContainer"></div>

                <div id="groupDetails" style="margin-top: 20px;">
                    <label style="display: none">Country of Origin:</label>
                    <select hidden id="groupCountry" required></select>

                    <label style="display: none">Region:</label>
                    <select hidden id="groupRegion" required></select>

                    <label>Phone Number:</label>
                    <input type="text" id="groupPhone" required>

                    <label>Email:</label>
                    <input type="email" id="groupEmail" readonly required>
                </div>
            </div>


            <button class="button" type="submit">Register</button>
        </form>

        <!-- Registration Success Modal -->
        <div id="registrationDisplay" class="modal-overlay hidden">
            <div class="modal-content" id="registrationModalContent">
                <!-- dynamic registration summary will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <p>&copy; 2025 Discover Sagada. All rights reserved.</p>
    </footer>

    <div id="loadingModal" class="modal-overlay hidden">
        <div class="modal-content">
            <p>Submitting your registration, please wait...</p>
        </div>
    </div>

    <div id="successModal" class="modal-overlay hidden">
        <div class="modal-content" id="successModalContent">
            <!-- dynamic registration summary will be inserted here -->
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const hamburger = document.getElementById("hamburger");
            const navLinks = document.getElementById("nav-links");

            const desktopLoginBtn = document.getElementById("authLinkDesktop");
            const mobileLoginBtn = document.getElementById("authLinkMobile");

            const desktopProfile = document.getElementById("profileDesktop");
            const mobileLogoutBtn = document.getElementById("logoutLinkMobile");
            const mobileProfile = document.getElementById("profileMobile");

            // === USER AUTH CHECK ===
            const userValidated = localStorage.getItem("userValidated") === "true";
            const userEmail = localStorage.getItem("userEmail");
            const userId = localStorage.getItem("userId");
            const userName = localStorage.getItem("userName");
            const isUserValid = userValidated && userEmail && userId && userName;

            // === REDIRECT TO LOGIN PAGE ===
            const goToLogin = () => {
                window.location.href = "/SagadaRegistrationSystem/user/user-auth.html";
            };

            // === LOGOUT HANDLER ===
            const logoutHandler = () => {
                localStorage.setItem("userValidated", "false");
                localStorage.removeItem("userEmail");
                localStorage.removeItem("userId");
                localStorage.removeItem("userName");
                window.location.href = "/SagadaRegistrationSystem/index.html";
            };

            // === SET VISIBILITY BASED ON AUTH ===
            function updateVisibility() {
                const isMobile = window.innerWidth <= 850;
                const desktopProfile = document.getElementById("profileDesktop");

                if (isUserValid) {
                    // USER IS LOGGED IN
                    if (desktopProfile) desktopProfile.style.display = isMobile ? "none" : "block";
                    if (mobileProfile) mobileProfile.style.display = isMobile ? "block" : "none";
                    if (mobileLogoutBtn) mobileLogoutBtn.style.display = isMobile ? "block" : "none";
                    if (desktopLoginBtn) desktopLoginBtn.style.display = "none";
                    if (mobileLoginBtn) mobileLoginBtn.style.display = "none";
                } else {
                    // USER IS NOT LOGGED IN
                    if (desktopLoginBtn) desktopLoginBtn.style.display = isMobile ? "none" : "block";
                    if (mobileLoginBtn) mobileLoginBtn.style.display = isMobile ? "block" : "none";
                    if (mobileLogoutBtn) mobileLogoutBtn.style.display = "none";
                    if (mobileProfile) mobileProfile.style.display = "none";
                    if (desktopProfile) desktopProfile.style.display = "none";
                }
            }

            // Update on resize (for responsiveness)
            window.addEventListener("resize", updateVisibility);

            // === EVENT BINDINGS ===
            if (isUserValid) {
                document.getElementById("body").style.visibility = "visible";
                // --- DESKTOP DROPDOWN ---
                const desktopDropdown = document.createElement("li");
                desktopDropdown.classList.add("dropdown-nav");
                desktopDropdown.id = "profileDesktop";
                desktopDropdown.innerHTML = `
            <a href="#">${userName} ▾</a>
            <ul class="dropdown-menu">
                <li><a href="/SagadaRegistrationSystem/user/profile/index.html">Profile</a></li>
                <li><button class="logout-btn desktop-logout" id="logoutLink">Logout</button></li>
            </ul>
        `;

                document.querySelector(".nav-right").prepend(desktopDropdown);

                document.getElementById("logoutLink")?.addEventListener("click", logoutHandler);
                document.getElementById("logoutLinkMobile")?.addEventListener("click", logoutHandler);
            } else {
                window.location.href = "/SagadaRegistrationSystem/user/user-auth.html";
                desktopLoginBtn?.addEventListener("click", goToLogin);
                mobileLoginBtn?.addEventListener("click", goToLogin);
            }

            // Run once on load
            updateVisibility();

            // === HAMBURGER MENU TOGGLE ===
            hamburger.addEventListener("click", () => {
                hamburger.classList.toggle("active");
                navLinks.classList.toggle("show");
            });

            // === DROPDOWN TOGGLE (FOR MOBILE) ===
            const dropdowns = document.querySelectorAll(".dropdown-nav");
            dropdowns.forEach(dropdown => {
                const link = dropdown.querySelector("a");
                link.addEventListener("click", (e) => {
                    if (window.innerWidth <= 850) {
                        e.preventDefault();
                        dropdown.classList.toggle("open");
                    }
                });
            });

            // === CLOSE MENU WHEN CLICKING OUTSIDE ===
            document.addEventListener("click", (e) => {
                if (!e.target.closest(".navbar")) {
                    navLinks.classList.remove("show");
                    hamburger.classList.remove("active");
                    dropdowns.forEach(d => d.classList.remove("open"));
                }
            });
        });
    </script>

</body>

</html>