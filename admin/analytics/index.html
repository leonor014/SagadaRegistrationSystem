<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tourism Analytics Dashboard</title>
  <link rel="stylesheet" href="./style.css" />
  <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script type="module" src="./script.js"></script>
</head>
<body>
  <div id="container">
    <nav>
            <div class="logo-name">
                <div class="logo-image">
                    <img id="userAvatar" src="https://avatar.iran.liara.run/username?username=Sagada+Registration"
                        alt="Sagada Logo">
                </div>
                <span class="logo_name" id="userNameDisplay"></span>
            </div>
            <div class="menu-items">
                <ul class="nav-links">
                    <li><a href="../dashboard/">
                            <i class="uil uil-estate"></i>
                            <span class="link-name">Dashboard</span>
                        </a></li>
                    <li><a href="../analytics/">
                            <i class="uil uil-chart-line"></i>
                            <span class="link-name">Analytics</span>
                        </a></li>
                    <li><a href="../reviews/">
                            <i class="uil uil-comments"></i>
                            <span class="link-name">Reviews</span>
                        </a></li>
                    <li><a href="../tourist-spots/">
                            <i class="uil uil-location-point"></i>
                            <span class="link-name">Tourist Spots</span>
                        </a></li>
                    <li><a href="../tourist-guidelines/">
                            <i class="uil uil-book-open"></i>
                            <span class="link-name">Tourist Guidelines</span>
                        </a></li>
                    <li><a href="../faq/">
                            <i class="uil uil-question-circle"></i>
                            <span class="link-name">FAQ</span>
                        </a></li>
                    <li><a href="../admins/">
                            <i class="uil uil-users-alt"></i>
                            <span class="link-name">Admins</span>
                        </a></li>
                </ul>
                <ul class="logout-mode">
                    <li>
                        <div>
                            <i class="uil uil-signout" id="logoutIcon"></i>
                            <button class="link-name logout-button" id="logoutBtn">Logout</button>
                        </div>
                    </li>
                    <li class="mode">
                        <a>
                            <i class="uil uil-moon"></i>
                            <span class="link-name">Dark Mode</span>
                        </a>
                        <div class="mode-toggle">
                            <span class="switch"></span>
                        </div>
                    </li>
                </ul>
            </div>
        </nav>

    <!-- Main Dashboard Content -->
    <section class="dashboard-main">
        <div class="top">
            <div class="top-container">
                <i class="uil uil-bars sidebar-toggle" ></i>
                <div class="dashboard-title">
                    <h1>Tourism Analytics Dashboard</h1>
                    <p>Insights into tourist visits and trends</p>
                </div>
            </div>
        </div>


        <div class="dashboard-content">
            <!-- Report type selector and site dropdown -->
            <div class="report-selector">
                <div class="selector-group">
                    <label for="report-type">Report Type:</label>
                    <select id="report-type">
                        <option value="general">General Analytics</option>
                        <option value="tourist-spot">Tourist Spot</option>
                    </select>
                </div>
                
                <div class="selector-group" id="site-selector-container">
                    <label for="site-dropdown">Tourist Site:</label>
                    <select id="site-dropdown">
                        <option value="__all">All Sites</option>
                    </select>
                </div>
            </div>

            <!-- Main content: Left: charts + top-left filters -->
            <main class="main-content">
                <section class="top-controls">
                    <div class="filters-left">
                        <label for="filter-type">View By:</label>
                        <select id="filter-type">
                            <option value="month">Monthly</option>
                            <option value="year">Yearly</option>
                        </select>
                        
                        <label for="month-filter" id="date-filter-label">Month</label>
                        <input type="month" id="month-filter" />
                        <button id="apply-filters">Apply</button>
                    </div>
                </section>

                <!-- Report Sections -->
                <div id="general-analytics" class="report-section active">
                    <div class="content-grid">
                        <section class="charts-container" id="general-charts-area">
                            <!-- Charts will be inserted here by JavaScript -->
                        </section>
                  
                        <aside class="analytics-sidebar">
                            <div class="analytics-card">
                                <h3 id="analytics-title">General Analytics</h3>
                                <div id="kpi-section" class="kpi-section">
                                    <!-- KPI cards will be inserted here -->
                                </div>
                            </div>

                            <div class="analytics-card">
                                <h3>Filters</h3>
                                <p>Current selection: <span id="current-filter-display">All data</span></p>
                                <p>Date range: <span id="date-range-display">September 2025</span></p>
                            </div>
                        </aside>
                    </div>
                </div>

                <div id="tourist-spot-analytics" class="report-section">
                    <div class="content-grid">
                        <section class="charts-container" id="tourist-charts-area">
                            <!-- Charts will be inserted here by JavaScript -->
                        </section>
                  
                        <aside class="analytics-sidebar">
                            <div class="analytics-card">
                                <h3>Tourist Spot Analytics</h3>
                                <div id="kpi-section-tourist" class="kpi-section">
                                    <!-- KPI cards will be inserted here -->
                                </div>
                            </div>

                            <div class="analytics-card">
                                <h3>Filters</h3>
                                <p>Current selection: <span id="current-site-display">All Sites</span></p>
                                <p>Date range: <span id="date-range-display-tourist">September 2025</span></p>
                            </div>
                        </aside>
                    </div>
                </div>
            </main>
        </div>
    </section>
  </div>

  <footer>
    <p>&copy; 2025 Discover Sagada. All rights reserved.</p>
  </footer>

  <script>
    
    const showSpinner = (element) => {
        element.innerHTML = '<span class="spinner"></span>';
    };

    const subscribeToDocumentCounts = () => {
        const collections = [
            { name: "reviews", el: document.querySelector('[data-type="reviews"]') },
            {
                name: "tourist-spots",
                el: document.querySelector('[data-type="tourist-spots"]'),
            },
            {
                name: "tourist-guidelines",
                el: document.querySelector('[data-type="tourist-guidelines"]'),
            },
                { name: "faqs", el: document.querySelector('[data-type="FAQs"]') },
            { name: "admins", el: document.querySelector('[data-type="admins"]') },
        ];

        collections.forEach(({ name, el }) => {
            if (!el) return;

            showSpinner(el);

            const colRef = collection(db, name);

            onSnapshot(
                colRef,
                (snapshot) => {
                    el.textContent = snapshot.size.toLocaleString();
                },
                (error) => {
                    console.error(`Error listening to ${name} collection:`, error);
                    el.textContent = "N/A";
                }
            );
        });
    };

    

    window.addEventListener("DOMContentLoaded", () => {
        const body = document.querySelector("body");
        const modeToggle = body.querySelector(".mode-toggle");
        const sidebar = body.querySelector("nav");
        const sidebarToggle = body.querySelector(".sidebar-toggle");
        const logoutBtn = document.getElementById("logoutBtn");
        const logoutIcon = document.getElementById("logoutIcon");

        let getMode = localStorage.getItem("mode");
        if (getMode === "dark") {
            body.classList.add("dark");
        }

        let getStatus = localStorage.getItem("status");
        if (getStatus === "close") {
            sidebar.classList.add("close");
        }

        modeToggle?.addEventListener("click", () => {
            body.classList.toggle("dark");
            localStorage.setItem(
                "mode",
                body.classList.contains("dark") ? "dark" : "light"
            );
        });

        sidebarToggle?.addEventListener("click", () => {
            sidebar.classList.toggle("close");
            localStorage.setItem(
                "status",
                sidebar.classList.contains("close") ? "close" : "open"
            );
        });

        const logoutHandler = () => {
            Swal.fire({
                icon: "success",
                title: "Logged Out",
                text: "You have been signed out.",
            }).then(async () => {
                try {
                    await signOut(auth);
                    localStorage.setItem("userValidated", "false");
                    window.location.href = "../../login-register.html";
                } catch (error) {
                    console.error("Logout error:", error);
                    Swal.fire({
                        icon: "error",
                        title: "Logout Failed",
                        text: "Something went wrong while logging out.",
                    });
                }
            });
        };

        if (logoutBtn) logoutBtn.addEventListener("click", logoutHandler);
        if (logoutIcon) logoutIcon.addEventListener("click", logoutHandler);

        const normalize = (path) => path.replace(/\/+$/, "");

        const currentPath = normalize(window.location.pathname);

        document.querySelectorAll(".nav-links li a").forEach((link) => {
            const linkPath = normalize(link.pathname);
            if (linkPath === currentPath) {
                link.classList.add("active");
            } else {
                link.classList.remove("active");
            }
        });
    });


  </script>
</body>
</html>